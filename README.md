# Geo Photo Tagger

Скрипт для автоматического геотегинга фотографий с использованием данных из Google Таблиц.

## Возможности

- Чтение данных о фотографиях из Google Таблиц
- Массовая обработка фотографий
- Добавление GPS-координат в EXIF
- Добавление расширенных метаданных (рейтинг, категории, теги, описания)
- Автоматическое получение информации о местоположении через Nominatim API
- Поддержка как отдельных файлов, так и директорий
- Кэширование геоданных
- Создание резервных копий файлов
- Многопоточная обработка

## Требования

- Python 3.7 или новее
- Установленные зависимости из requirements.txt
- Доступ к интернету для работы с API
- Настроенная аутентификация Google Sheets

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/robinso1/geo.git
cd geo
```

2. Создайте виртуальное окружение и активируйте его:
```bash
python -m venv venv
source venv/bin/activate  # для Linux/Mac
venv\Scripts\activate     # для Windows
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Скопируйте `.env.example` в `.env` и настройте переменные окружения:
```bash
cp .env.example .env  # для Linux/Mac
copy .env.example .env  # для Windows
```

5. Создайте и настройте файл с учетными данными Google API (credentials.json)

## Настройка Google Sheets

1. Создайте проект в Google Cloud Console
2. Включите Google Sheets API
3. Создайте сервисный аккаунт и скачайте credentials.json
4. Поместите credentials.json в корневую директорию проекта
5. Предоставьте доступ к таблице для сервисного аккаунта
6. Укажите ID таблицы в файле .env (SPREADSHEET_ID)

## Формат таблицы

Обязательные столбцы:
- Путь - путь к файлу или директории
- Широта - координата широты
- Долгота - координата долготы

Дополнительные столбцы:
- Рейтинг - числовой рейтинг фото (0-5)
- Категория - категория фото
- Подкатегория - подкатегория фото
- Ключевые слова - теги через запятую
- Описание - текстовое описание
- Контакты - контактная информация
- URL - связанная веб-ссылка
- Город - название города
- Страна - название страны
- Индекс - почтовый индекс
- Адрес - полный адрес
- Email - электронная почта
- Подпись - подпись к фото
- Текст подписи - дополнительный текст

## Использование

```bash
# Запуск скрипта
python geo_tagger.py
```

## Особенности работы

- Скрипт автоматически создает директории для логов и кэша
- Перед изменением файлов создаются резервные копии (с расширением .backup)
- Обрабатываются только файлы с расширениями .jpg и .jpeg (в любом регистре)
- При обработке директории обрабатываются все поддиректории рекурсивно
- Поддерживаются как абсолютные, так и относительные пути
- Корректно обрабатывается кириллица в путях и метаданных
- Работает на Windows и Mac OS

## Логирование

Логи сохраняются в директории `logs/`:
- main.log - основной лог программы
- photo_processor.log - лог обработки фотографий
- google_sheets.log - лог работы с Google Sheets
- geo_utils.log - лог геокодирования

## Кэширование

Геоданные кэшируются в директории `cache/` для оптимизации запросов к API.

## Безопасность

- Создаются резервные копии файлов перед модификацией
- Проверяются права доступа к файлам
- Токены хранятся в переменных окружения
- Поддерживается безопасная работа с API

## Ограничения

- Поддерживаются только форматы: JPG, JPEG
- Требуется доступ к интернету для работы с API
- Есть ограничения на количество запросов к API
- На Windows может потребоваться запуск от имени администратора

## Устранение неполадок

Если скрипт не работает:

1. Проверьте наличие и правильность файла credentials.json
2. Убедитесь, что указан правильный SPREADSHEET_ID в .env
3. Проверьте права доступа к файлам и директориям
4. Проверьте формат данных в Google Таблице
5. Проверьте логи в директории logs/ 